<% if site["ignore"] or site["ignore_web"]%>
#ignore
<% end %>
#
# This file is auto-generated. Please do not modify!
# Generated by QA Generator v<%= QA_GENERATE_VERSION %>
#
@sanity
@web
@<%= site["site_name"] %>
<% if site["integration"] %>
@<%= site["integration"] %>
<% end %>
Feature: <%= site["pretty_name"] %> Integration
#
# Tracking tests
#
<% if site["site_timeout"] %>
Background:
	Given the site can take up to <%=site["site_timeout"] %> seconds to load each page.  
<% end %>

<% for page_name in ["home", "category", "product"] %>
<% page = site[page_name+"_page"] %>
<% if page["ignore"] %>
@ignore
<% end %>
@<%= page_name %>_page
Scenario: <%= site["pretty_name"] %> <%= page_name %> page is tracked correctly
<% if page.has_key?("custom_tracking_test") %>
  <%= page["custom_tracking_test"] %>
<% else %>
  Given I am on the <%= site["site_name"] %> <%= page_name %> page
<% if site["needs_SPR"] or page["needs_SPR"] %>
  And I use the SPR key
<% end %>
  <%= extra_steps_rule(page["extra_steps"]) %>
  Then it should be tracked as a <%= page_name %> page
  <%= expect_recs_rule(page["expected_recs"]) %>

<% end %>
<% end %>

<% page = site["basket_page"] %>
<% if page["ignore"] %>
@ignore
<% end %>
@basket_page
Scenario: <%= site["pretty_name"] %> basket page is tracked correctly
<% if page.has_key?("custom_tracking_test") %>
  <%= page["custom_tracking_test"] %>
<% else %>
  Given I am on the <%= site["site_name"] %> basket page
<% if site["needs_SPR"] or page["needs_SPR"] %>
  And I use the SPR key
<% end %>
  And I remove all of the products from the basket
  And I go to the product page
  <%= extra_steps_rule(site["product_page"]["extra_steps"]) %>
  And I add the current product to the basket
  And I pause for 2 seconds
  And I go to the basket page
  Then it should be tracked as a basket page 
  <%= expect_recs_rule(page["expected_recs"]) %>
<% end %>

<% page = site["checkout_page"] %>
<% if page["ignore"] %>
@ignore
<% end %>
@checkout_page
Scenario: <%= site["pretty_name"] %> checkout page is tracked correctly
<% if page.has_key?("custom_tracking_test") %>
  <%= page["custom_tracking_test"] %>
<% else %>
  Given I am on the <%= site["site_name"] %> home page
<% if site["needs_SPR"] or page["needs_SPR"] %>
  And I use the SPR key
<% end %>
  And I pause for 10 seconds
<% if site["home_page"]["login_link"] %>
  When I click login
  And I login as "<%= site["username"] %>" using password "<%= site["password"] %>"
<% end %>
  And I go to the basket page
  And I pause for 10 seconds
  And I remove all of the products from the basket
  <%= extra_steps_rule(site["login_page"]["extra_steps"]) %>
  And I go to the product page
  <%= extra_steps_rule(site["product_page"]["extra_steps"]) %>
  And I add the current product to the basket
  And I pause for 2 seconds
  And I go to the basket page
  And I pause for 10 seconds
  And I click checkout
  <%= extra_steps_rule(page["extra_steps"]) %>
  Then it should be tracked as a Checkout page
  <%= expect_recs_rule(page["expected_recs"]) %>
<% end %>

<% page = site["searchresults_page"] %>
<% if page["ignore"] %>
@ignore
<% end %>
@search_page
Scenario: <%= site["pretty_name"] %> search results page is tracked correctly
<% if page.has_key?("custom_tracking_test") %>
<%= page["custom_tracking_test"] %>
<% else %>
    Given I am on the <%= site["site_name"] %> homepage
<% if site["needs_SPR"] or page["needs_SPR"] %>
    And I use the SPR key
<% end %>
    When I search for "<%= site["valid_search_term"] %>"
    Then it should be tracked as a search results page
    <%= expect_recs_rule(page["expected_recs"]) %>
<% end %>
<% if page["zerosearch_recs"] > 0 %>
#
# Zero search tests
#
@search_page
@zero_search_page
<% if page["ignore"] %>
@ignore
<% end %>
Scenario: <%= site["pretty_name"] %> zero search recommendations are shown
<% if page.has_key?("custom_tracking_test") %>
<%= page["custom_tracking_test"] %>
<% else %>
    Given I am on the <%= site["site_name"] %> homepage
    <% if site["needs_SPR"] or page["needs_SPR"] %>
    And I use the SPR key
    <% end %>
    When I search for "<%= site["zero_search_term"] %>"
	And I pause for 20 seconds
    Then it should be tracked as a search results page
    <%= expect_recs_rule(page["zerosearch_recs"]) %>
<% end %>
<% end %>

<% if site["order_page"] %>
<% page = site["order_page"] %>
<% if page["ignore"] %>
@ignore
<% end %>
@order_page
Scenario: <%= site["pretty_name"] %> order page is tracked correctly
  Given I am on the <%= site["site_name"] %> home page
  And I pause for 2 seconds
<% if site["home_page"]["login_link"] %>
  When I click login
  And I login as "<%= site["username"] %>" using password "<%= site["password"] %>"
<% end %>
  And I go to the basket page
  And I pause for 10 seconds
  And I remove all of the products from the basket
  <%= extra_steps_rule(site["login_page"]["extra_steps"]) %>
  And I go to the product page
  <%= extra_steps_rule(site["product_page"]["extra_steps"]) %>
  And I add the current product to the basket
  And I pause for 2 seconds
  And I go to the basket page
  And I pause for 10 seconds
  And I click checkout
  <%= extra_steps_rule(page["extra_steps"]) %>
  Then it should be tracked as a Order page
<% end %>

<% if site["has_content"] %>
<% page = site["home_page"] %>
#
# SMART-content tests
#
<% if page["ignore"] %>
@ignore
<% end %>
Scenario: SMART-content links work on on <%= site["pretty_name"] %> homepage
<% if page.has_key?("custom_tracking_test") %>
<%= page["custom_tracking_test"] %>
<% else %>
    Given I am on the <%= site["site_name"] %> homepage
    <% if site["needs_SPR"] or page["needs_SPR"] %>
    And I use the SPR key
    <% end %>
    And I click the first SMART-content creative image
    Then it should be tracked as a category page
<% end %>
<% end %>

<% page = site["home_page"] %>
<% if page.has_key?("category_menu") %>
<% if page["ignore"] %>
@ignore
<% end %>
@allcategories
Scenario: All <%= site["pretty_name"] %> category pages are tracked correctly
    Given I am on the <%= site["site_name"] %> homepage
    <% if site["needs_SPR"] or page["needs_SPR"] %>
    And I use the SPR key
    <% end %>
    Then all categories should be tracked as Category pages except:
    <% page["category_menu_exclude"].each do |category| %>
    | <%= category %> |
    <% end %>
<% end %>


